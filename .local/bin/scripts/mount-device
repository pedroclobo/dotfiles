#!/bin/sh
# Script to mount external devices

# Partitions with appended size in GB
partitions="$(lsblk -rpo "name,type,size,mountpoint" | grep "part" | \
	awk '$4=="" {printf "%s (%s)\n",$1,$3}')"

# Return the partition label
get_partition_label() {

	# Return if device has no label
	! blkid ${1} | grep -q "LABEL" && return

	label="$(blkid ${1} | awk '{print $2}' | awk -F \" '{print $2}')"
	echo "$label"
}

# Prompt for partition
choice="$(echo "$partitions" | dmenu -i -p "What drive to mount?")"
partition="$(echo "$choice" | awk '{print $1}')"
label="$(get_partition_label ${partition})"

# Mount the partition
mount="/run/media/${SUDO_USER}/${label}"
! [ -d "$mount" ] && mkdir -p "$mount"
mount "$partition" "$mount"
